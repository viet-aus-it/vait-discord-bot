# OpAMP Supervisor Configuration for TinyOlly
# This supervisor manages the OpenTelemetry Collector and accepts remote configuration
# from the TinyOlly OpAMP server.

server:
  endpoint: ws://tinyolly-opamp-server:4320/v1/opamp

capabilities:
  # Accept remote configuration from OpAMP server
  accepts_remote_config: true
  # Accept restart commands
  accepts_restart_command: true
  # Report the effective (running) configuration back to server
  reports_effective_config: true
  # Report health status
  reports_health: true

storage:
  # Directory for supervisor to store cached data
  directory: /var/lib/otelcol/supervisor

agent:
  # Path to the collector binary
  executable: /opt/otelcol/bin/otelcol-contrib

  # How often to check if the collector process is still running
  orphan_detection_interval: 5s

  # Timeout for collector startup
  bootstrap_timeout: 10s

  # Configuration files to use
  # When $REMOTE_CONFIG is provided via OpAMP, it completely replaces the base config
  # (the supervisor handles this as a full replacement, not a merge)
  # The base config is only used until a remote config is first received
  config_files:
    - /etc/otelcol/config.yaml
    - $REMOTE_CONFIG

  # Allow the collector to start without any pipelines initially
  # (useful when waiting for remote config)
  args:
    - "--feature-gates"
    - "service.AllowNoPipelines"
